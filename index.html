<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>html-editor 富文本编辑器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2196F3;
        }

        .editor-container {
            max-width: 1000px;
            margin: 2rem auto;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px 8px 0 0;
        }

        .toolbar-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .toolbar-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        #editor {
            min-height: 400px;
            padding: 20px;
            border: 1px solid #ddd;
            outline: none;
            overflow-y: auto;
            line-height: 1.6;
        }

        .status-bar {
            padding: 8px 20px;
            background: #f5f5f5;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #666;
        }

        input[type="color"], 
        input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <div class="toolbar">
            <button class="toolbar-btn" onclick="execCommand('undo')">
                <i class="fas fa-undo"></i>
            </button>
            <button class="toolbar-btn" onclick="execCommand('redo')">
                <i class="fas fa-redo"></i>
            </button>
            
            <select class="toolbar-btn" onchange="setFontSize(this.value)">
                <option value="">字号</option>
                <option value="12px">12px</option>
                <option value="14px">14px</option>
                <option value="16px">16px</option>
                <option value="18px">18px</option>
            </select>

            <button class="toolbar-btn" onclick="execCommand('bold')">
                <i class="fas fa-bold"></i>
            </button>
            <button class="toolbar-btn" onclick="execCommand('italic')">
                <i class="fas fa-italic"></i>
            </button>
            <button class="toolbar-btn" onclick="execCommand('underline')">
                <i class="fas fa-underline"></i>
            </button>

            <button class="toolbar-btn" onclick="setColor('foreColor')">
                <i class="fas fa-font"></i>
            </button>
            <button class="toolbar-btn" onclick="setColor('hiliteColor', '背景颜色')">
                <i class="fas fa-highlighter"></i>
            </button>

            <button class="toolbar-btn" onclick="execCommand('insertUnorderedList')">
                <i class="fas fa-list-ul"></i>
            </button>
            <button class="toolbar-btn" onclick="execCommand('insertOrderedList')">
                <i class="fas fa-list-ol"></i>
            </button>

            <button class="toolbar-btn" onclick="insertLink()">
                <i class="fas fa-link"></i>
            </button>
            
            <button class="toolbar-btn" onclick="document.getElementById('imageUpload').click()">
                <i class="fas fa-image"></i>
            </button>

            <button class="toolbar-btn" onclick="toggleFullscreen()">
                <i class="fas fa-expand"></i>
            </button>
        </div>

        <div id="editor" contenteditable="true"></div>
        
        <div class="status-bar">
            <span id="charCount">字数：0</span>
            <span>提示：Ctrl+S 自动保存</span>
        </div>
    </div>

    <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(event)">

    <script>
        const editor = document.getElementById('editor');
        let isFullscreen = false;

        // 初始化本地存储
        editor.innerHTML = localStorage.getItem('editorContent') || '';
        updateCharCount();

        // 核心命令执行
        function execCommand(command, value = null) {
            document.execCommand(command, false, value);
            editor.focus();
            saveContent();
        }

        // 颜色选择
        function setColor(command, type = '文字颜色') {
            const color = prompt(`请输入${type}（十六进制值，例如#FF0000）:`);
            if (color) execCommand(command, color);
        }

        // 设置字号
        function setFontSize(size) {
            if (size) execCommand('fontSize', false, size);
        }

        // 插入链接
        function insertLink() {
            const url = prompt('请输入链接地址：');
            if (url) execCommand('createLink', false, url);
        }

        // 图片上传处理
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file.type.startsWith('image/')) return alert('请选择图片文件');

            const reader = new FileReader();
            reader.onload = (event) => {
                const img = document.createElement('img');
                img.src = event.target.result;
                img.style.maxWidth = '100%';
                editor.appendChild(img);
                saveContent();
            }
            reader.readAsDataURL(file);
        }

        // 全屏切换
        function toggleFullscreen() {
            const container = document.querySelector('.editor-container');
            if (!isFullscreen) {
                container.style.position = 'fixed';
                container.style.top = '0';
                container.style.left = '0';
                container.style.width = '100vw';
                container.style.height = '100vh';
                container.style.zIndex = '1000';
            } else {
                container.style = '';
            }
            isFullscreen = !isFullscreen;
        }

        // 自动保存
        function saveContent() {
            localStorage.setItem('editorContent', editor.innerHTML);
            updateCharCount();
        }

        // 字数统计
        function updateCharCount() {
            const text = editor.innerText.replace(/\s+/g, '');
            document.getElementById('charCount').textContent = `字数：${text.length}`;
        }

        // 事件监听
        editor.addEventListener('input', saveContent);
        
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveContent();
                alert('内容已保存！');
            }
        });
    </script>
</body>
</html>
